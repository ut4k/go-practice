# RecoveryMiddleware の趣旨とポイント

## 趣旨

Go の HTTP サーバーはリクエスト処理中に `panic` が発生すると、その処理が即座にクラッシュし、何もレスポンスが返せなくなる。  
本関数 `RecoveryMiddleware` は **panic を捕捉して 500 エラー(JSON形式) を返す** ことで、  
- サーバー全体の停止を防ぐ  
- クライアントに統一的なエラーレスポンスを返せる  

という目的で作られている。

---

## ポイント

- **defer**
  - 関数終了時に必ず実行される処理を登録  
  - panic が起きても呼ばれる  

- **func() { ... }()**
  - 無名関数を定義して即実行  
  - defer に複数行の処理をまとめて登録できる  

- **recover()**
  - panic を捕捉する組込み関数  
  - panic がなければ `nil`、あれば値を返す  

- **if err := recover(); err != nil**
  - panic があった場合のみエラーハンドリングを実行  

👉 まとめ: **サーバーを落とさずに panic をキャッチし、500 エラーレスポンスを返すための安全装置**
